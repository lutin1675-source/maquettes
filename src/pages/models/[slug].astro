---
import Layout from '../../layouts/Layout.astro';
import SiteChrome from '../../components/SiteChrome.astro';
import { getAllModels, slugifyText } from '../../lib/models';
import type { ModelEntry } from '../../lib/models';

export async function getStaticPaths() {
	const models = getAllModels();
	return models.map((model) => ({
		params: { slug: model.slug },
		props: { model },
	}));
}

const { model } = Astro.props as { model: ModelEntry };
const pageTitle = `${model.modelName} – ${model.reference || 'Fiche'}`;
const base = import.meta.env.BASE_URL || '/';
---

<Layout title={pageTitle} description={model.summary}>
	<SiteChrome className="space-y-10">
		<nav class="text-xs uppercase tracking-[0.3em] text-[var(--tm-muted)]">
			<a class="text-[var(--tm-lagoon)]" href={base}>Accueil</a>
			<span class="px-2 text-[var(--tm-muted)]/60">/</span>
			<span>{model.modelName}</span>
		</nav>

		<section class="grid gap-6 md:grid-cols-2">
			<div class="tm-panel rounded-xl p-8">
				<p class="brand-pill text-[var(--tm-lagoon)]/80">{model.manufacturer || 'Toton Maquette'}</p>
				<h1 class="mt-4 text-4xl leading-tight">{model.modelName}</h1>
				{model.reference && <p class="text-[var(--tm-muted)]">Référence {model.reference}</p>}
				<p class="mt-4 text-[var(--tm-muted)]">
					{model.summary ||
						'Retrouve dans cette fiche tout l’historique pertinent, les références de peinture fiables et les corrections atelier recommandées.'}
				</p>
			</div>
			<div class="tm-panel rounded-xl p-6">
				<ul class="space-y-3 text-sm">
					<li class="flex items-center justify-between border-b border-white/10 pb-3">
						<span class="text-[var(--tm-muted)]">Slug</span>
						<span class="font-semibold">{model.slug}</span>
					</li>
					<li class="flex items-center justify-between border-b border-white/10 pb-3">
						<span class="text-[var(--tm-muted)]">Sections documentées</span>
						<span class="font-semibold">{model.docs.length}</span>
					</li>
					<li class="flex items-center justify-between">
						<span class="text-[var(--tm-muted)]">Dernière mise à jour</span>
						<span class="font-semibold">{new Date().toLocaleDateString('fr-FR')}</span>
					</li>
				</ul>
				<a
					class="mt-5 inline-flex w-full items-center justify-center rounded-full bg-[var(--tm-coral)] px-6 py-3 text-xs font-semibold uppercase tracking-[0.4em] text-slate-950"
					href="mailto:bonjour@toton-maquette.com"
				>
					Partager un retour de montage
				</a>
			</div>
		</section>

		<aside class="tm-panel rounded-xl p-6">
			<p class="section-label text-[var(--tm-lagoon)]">Sections</p>
			<ul class="mt-4 space-y-2">
				{model.docs.map((doc) => (
					<li>
						<a class="font-semibold text-[var(--tm-text)] hover:text-[var(--tm-lumen)]" href={`#${slugifyText(doc.title)}`}>
							{doc.title}
						</a>
					</li>
				))}
			</ul>
		</aside>

		{model.docs.map((doc) => (
			<section id={slugifyText(doc.title)} class="tm-panel scroll-mt-32 rounded-xl p-8">
				<div class="mb-6 flex items-center justify-between gap-4">
					<h2 class="text-3xl">{doc.title}</h2>
					<a
						class="text-sm uppercase tracking-[0.3em] text-[var(--tm-lagoon)]"
						href={`#${slugifyText(doc.title)}`}
						aria-label={`Lien vers ${doc.title}`}
					>
						#
					</a>
				</div>
				<div class="prose prose-neutral max-w-none" set:html={doc.html} />
			</section>
		))}
	</SiteChrome>
</Layout>
